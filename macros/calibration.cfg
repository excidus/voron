[gcode_macro CALIBRATE_EXTRUDER]
description: Follows the extruder calibration instructions from Ellis3D
gcode:
  M83  # Set extruder to relative mode
  G1 E100 F60 ; Extrude 100mm at 1mm/s (60mm/min)

[gcode_macro SWEEP_TEST]
variable_max_velocity: 300

gcode:
    _CG28
    G90                          ; Use absolute positioning
    G1 Y345 F{0.8 * max_velocity * 60}  ; Move to Y max - 10 at 80% speed

    # Perform 100 sweeps between X50 and X300
    {% for i in range(100) %}
        G1 X5 F{0.8 * max_velocity * 60}   ; Move to X50 at 80% speed
        G1 X345 F{0.8 * max_velocity * 60}  ; Move to X300 at 80% speed
    {% endfor %}

    M117 Sweep Test Completed  ; Display message on LCD

[gcode_macro CALIBRATE_BELTS]
gcode:
  G1 X200 Y150 Z221 F10000

[gcode_macro TEST_COREXY_SKEW]
description: "Test CoreXY stepper sync and skew"
gcode:
    {% set move_dist = 100 %}
    {% set feedrate = 6000 %}  # mm/min = 100 mm/s

    G91                             ; Relative positioning
    M118 Testing CoreXY Skew Start

    ; Move in a square: X+, Y+, X-, Y-
    G1 X{move_dist} F{feedrate}
    G1 Y{move_dist} F{feedrate}
    G1 X-{move_dist} F{feedrate}
    G1 Y-{move_dist} F{feedrate}

    ; Move diagonally: X+Y+, X-Y-, etc
    G1 X{move_dist} Y{move_dist} F{feedrate}
    G1 X-{move_dist} Y-{move_dist} F{feedrate}
    G1 X-{move_dist} Y{move_dist} F{feedrate}
    G1 X{move_dist} Y-{move_dist} F{feedrate}

    ; Repeat square for extra test
    G1 X{move_dist} F{feedrate}
    G1 Y{move_dist} F{feedrate}
    G1 X-{move_dist} F{feedrate}
    G1 Y-{move_dist} F{feedrate}

    G90                             ; Absolute positioning
    M118 CoreXY Skew Test Complete - check if toolhead returned to origin
